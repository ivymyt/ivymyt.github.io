/*
Text Countlet v0.6
last revision: 2010-04-26

Contact Ivy Tsai ( http://github.com/ivymyt ) regarding bugs,
suggestions, and improvements.

This work is licensed under the
Creative Commons Attribution-Noncommercial-Share Alike 2.5 Canada License.
To view a copy of this licence, visit
http://creativecommons.org/licenses/by-nc-sa/2.5/ca/

PLEASE RETAIN THIS MESSAGE WHEN REPRODUCING.
*/

var aqp_ct_cssUrl="http://ivymyt.github.io/countlet/countlet.css";var aqp_ct_consoleL=10,aqp_ct_consoleT=10;var aqp_ct_console,aqp_ct_longInfo,aqp_ct_shortInfo,aqp_ct_status,aqp_ct_closeB;var aqp_ct_mode="word",aqp_ct_paraMode=1,aqp_ct_smartPunc=true,aqp_ct_noPunc=false,aqp_ct_selected,aqp_ct_mouseX,aqp_ct_mouseY;function aqp_ct_init(){var g=document;if(g.getElementById("aqp_ct_console")){return}var k=g.createElement("link");k.type="text/css";k.rel="stylesheet";k.href=aqp_ct_cssUrl;g.getElementsByTagName("head")[0].appendChild(k);aqp_ct_console=g.createElement("div");aqp_ct_console.id="aqp_ct_console";aqp_ct_console.style.left=aqp_ct_consoleL+"px";aqp_ct_console.style.top=aqp_ct_consoleT+"px";g.body.appendChild(aqp_ct_console);var h=aqp_appendText(aqp_ct_console,"","div",["id","aqp_ct_titlebar"]);aqp_ct_closeB=aqp_appendText(h,"","div",["id","aqp_ct_closebn"]);aqp_appendText(aqp_ct_closeB,String.fromCharCode(215),"div");aqp_ct_closeB.onclick=aqp_ct_close;aqp_ct_count();aqp_ct_updateStatus();aqp_ct_shortInfo=g.createElement("div");aqp_ct_shortInfo.id="aqp_ct_shortinfo";aqp_appendText(aqp_ct_shortInfo,"Press ");aqp_appendText(aqp_ct_shortInfo,"i","b");aqp_appendText(aqp_ct_shortInfo," for instructions");aqp_ct_console.appendChild(aqp_ct_shortInfo);var f=[["c","switch to character count"],["w","switch to word count"],["p","switch to paragraph count"],["1, 2","set the number of line breaks between paragraphs"],["s","toggle punctuation mode"],["i","show/hide instructions"],["[esc]","close this window"]];aqp_ct_longInfo=g.createElement("div");aqp_ct_longInfo.id="aqp_ct_longinfo";aqp_ct_longInfo.style.display="none";var e=g.createElement("dl");for(var c=0,b=f.length,a,j;c<b;c++){a=g.createElement("dt");aqp_appendText(a,f[c][0]);e.appendChild(a);j=g.createElement("dd");aqp_appendText(j,f[c][1]);e.appendChild(j)}aqp_ct_longInfo.appendChild(e);aqp_ct_console.appendChild(aqp_ct_longInfo);aqp_addEvent(g,"mouseup",aqp_ct_mouseUp);aqp_addEvent(g,"keyup",aqp_ct_keyUp);aqp_addEvent(aqp_ct_console,"mousedown",aqp_ct_cMouseDown);if(typeof(aqp_ct_console.onselectstart)!=undefined){aqp_ct_console.attachEvent("onselectstart",rfalse);aqp_ct_closeB.attachEvent("onselectstart",rfalse);aqp_ct_status.attachEvent("onselectstart",rfalse);aqp_ct_shortInfo.attachEvent("onselectstart",rfalse);aqp_ct_longInfo.attachEvent("onselectstart",rfalse)}}function aqp_ct_close(){aqp_removeEvent(document,"mouseup",aqp_ct_mouseUp);aqp_removeEvent(document,"keyup",aqp_ct_keyUp);document.body.removeChild(aqp_ct_console)}function aqp_ct_cMouseDown(c){if(document.all){aqp_ct_mouseX=window.event.clientX;aqp_ct_mouseX=window.event.clientY}else{aqp_ct_mouseX=c.clientX;aqp_ct_mouseY=c.pageY}var b=aqp_ct_console.style.left;var a=aqp_ct_console.style.top;if((typeof(b)=="string")&&(b.indexOf("px")>-1)){aqp_ct_consoleL=parseInt(b.substring(0,b.length-2));aqp_ct_consoleT=parseInt(a.substring(0,a.length-2))}else{aqp_ct_consoleL=b;aqp_ct_consoleL=a}aqp_addEvent(document,"mousemove",aqp_ct_cMouseMove)}function aqp_ct_cMouseMove(c){var b=aqp_ct_consoleL-aqp_ct_mouseX;var a=aqp_ct_consoleT-aqp_ct_mouseY;if(document.all){aqp_ct_console.style.left=b+window.event.clientX;aqp_ct_console.style.top=a+window.event.clientY}else{aqp_ct_console.style.left=(b+c.clientX)+"px";aqp_ct_console.style.top=(a+c.clientY)+"px"}}function aqp_ct_mouseUp(a){aqp_removeEvent(document,"mousemove",aqp_ct_cMouseMove);aqp_ct_count()}function aqp_ct_keyUp(b){var a="Unable to change settings.";if(!b){if(window.event){b=window.event}else{aqp_ct_addMsg(a);return}}if(typeof(b.keyCode)=="number"){b=b.keyCode}else{if(typeof(b.charCode)=="number"){b=b.charCode}else{aqp_ct_addMsg(a);return}}switch(b){case 27:aqp_ct_close();return;case 49:aqp_ct_paraMode=1;break;case 50:aqp_ct_paraMode=2;break;case 67:aqp_ct_mode="character";break;case 73:if(aqp_ct_shortInfo.style.display=="none"){aqp_ct_shortInfo.style.display="block";aqp_ct_longInfo.style.display="none"}else{aqp_ct_shortInfo.style.display="none";aqp_ct_longInfo.style.display="block"}break;case 80:aqp_ct_mode="paragraph";break;case 83:if(aqp_ct_mode=="word"){aqp_ct_smartPunc=aqp_ct_smartPunc?false:true}else{if(aqp_ct_mode=="character"){aqp_ct_noPunc=aqp_ct_noPunc?false:true}}break;case 87:aqp_ct_mode="word";break}aqp_ct_count();aqp_ct_updateStatus()}function aqp_ct_count(){if(window.getSelection){var a,c=window.getSelection();if(window.getSelection().toString()==""){aqp_ct_selected=""}else{if(c.getRangeAt){a=c.getRangeAt(0)}else{a=document.createRange();a.setStart(c.anchorNode,c.anchorOffset);a.setEnd(c.focusNode,c.focusOffset)}if(c.containsNode(aqp_ct_console,true)){a.setEndBefore(aqp_ct_console)}aqp_ct_selected=a.toString()}}else{if(document.selection){aqp_ct_selected=document.selection.createRange().text}}if(aqp_ct_selected==""||aqp_ct_selected==null||aqp_ct_selected==undefined){aqp_ct_changeMsg("Select text to calculate.")}else{var b=0;switch(aqp_ct_mode){case"word":b=aqp_ct_word(aqp_ct_selected);break;case"paragraph":b=aqp_ct_para(aqp_ct_selected);break;case"character":b=aqp_ct_char(aqp_ct_selected);break}aqp_ct_changeMsg(aqp_ct_pluralize(b,aqp_ct_mode)+".")}}function aqp_ct_word(e){var d=0;var c=false;for(var b=0,a=e.length;b<a;b++){if(c&&e[b]=="\n"&&aqp_ct_isHyphen(e.charCodeAt(b-1))){}else{if(c&&aqp_ct_isWordSplitter(b)){d++;c=false}else{if(aqp_ct_smartPunc){if(!aqp_ct_isPunc(e.charCodeAt(b))){c=true}}else{c=true}}}}if(c){d++}return d}function aqp_ct_para(f){for(var d=0,e="";d<aqp_ct_paraMode;d++){e+="\n"}var c=f.split(e);var b=0;for(var d=0,a=c.length;d<a;d++){if(c[d]!=""){b++}}return b}function aqp_ct_char(e){var b=e.length;var c=b;if(aqp_ct_noPunc){for(var d=0,a;d<b;d++){if(aqp_ct_isPunc(e.charCodeAt(d))){c--}}}return c}function aqp_ct_isHyphen(a){if(a==45||a==8208||a==8211){return true}return false}function aqp_ct_isPunc(a){if(a<48){return true}else{if(a>57&&a<65){return true}else{if(a>90&&a<97){return true}else{if(a>123&&a<128){return true}else{if(a>=8192&&a<=8303){return true}else{if(a>=57344&&a<=57599){return true}}}}}}return false}function aqp_ct_isWordSplitter(a){var e=3;var d=a-e+1;if(d<0){d=0}var c=aqp_ct_selected.substring(d,a+1);if(!aqp_ct_smartPunc&&(c.length>1)&&((c.substr(1)=="--")||(c=="..."))){return true}else{var b=aqp_ct_selected.charCodeAt(a);if(((b>=9)&&(b<=13))||(b==32)){return true}else{if(!aqp_ct_smartPunc&&((b==47)||(b==92)||((b>=8210)&&(b<=8213))||(b==8230))){return true}}}return false}function aqp_ct_updateStatus(){var a=aqp_ct_mode+" count mode\n";if(aqp_ct_mode=="paragraph"){a+=aqp_ct_pluralize(aqp_ct_paraMode,"line break")+" per paragraph\n"}else{if(aqp_ct_mode=="word"){if(aqp_ct_smartPunc){a+="smart "}else{a+="normal "}a+="punctuation mode"}else{if(aqp_ct_noPunc){a+="don't "}a+="count punctuation"}}aqp_replace(aqp_ct_console,"div","aqp_ct_status",a)}function aqp_ct_addMsg(a){aqp_appendText(document.getElementById("aqp_ct_msg"),a)}function aqp_ct_changeMsg(a){aqp_replace(aqp_ct_console,"div","aqp_ct_msg",a)}function aqp_ct_pluralize(b,a,c){if(c==""||c==null||c==undefined){c="s"}if(b!=1&&b!=-1){a+=c}a=b+" "+a;return a}function aqp_appendText(e,f,d){if(d!=""&d!=null&&d!=undefined){var g=e;e=document.createElement(d);g.appendChild(e);for(var c=3;c<arguments.length;c++){e.setAttribute(arguments[c][0],arguments[c][1])}}var b=f.split("\n");for(var c=0,a=b.length;c<a-1;c++){e.appendChild(document.createTextNode(b[c]));e.appendChild(document.createElement("br"))}e.appendChild(document.createTextNode(b[b.length-1]));return e}function aqp_replace(c,b,f,d){var a=document.getElementById(f);var e=document.createElement(b);aqp_appendText(e,d);e.setAttribute("id",f);if(a==null||a==undefined){aqp_ct_console.appendChild(e)}else{aqp_ct_console.replaceChild(e,a)}return e}function aqp_addEvent(a,b,c){if(a.addEventListener){a.addEventListener(b,c,false)}else{if(a.attachEvent){a.attachEvent("on"+b,c)}else{a["on"+b]=c}}}function aqp_removeEvent(a,b,c){if(a.removeEventListener){a.removeEventListener(b,c,false)}else{if(a.detachEvent){a.detachEvent("on"+b,c)}else{if(a["on"+b]==c){a["on"+b]=null}}}}aqp_ct_init();